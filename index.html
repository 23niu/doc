<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API 接口草稿</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["http","node"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
        <div class="lang-selector">
              <a href="#" data-language-name="http">http</a>
              <a href="#" data-language-name="node">Node.js</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://shimo.im'>石墨首页</a></li>
            <li><a href='https://github.com/shimohq'>石墨 GitHub</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="介绍">介绍</h1>

<p>此文档定义的 API 正在开发中，具体接口字段可能会有细节调整。</p>

          <h1 id="oauth-授权">OAuth 授权</h1>

<p>石墨鉴权接口遵循 <a href="https://tools.ietf.org/html/rfc6749">OAuth 2.0 协议</a>。OAuth 是一个能使得第三方应用在无需知道用户的密码的前提下读写用户私有资源的标准协议，第三方应用通过 OAuth 协议向用户请求授权后，可以获得一个 Access Token，此后即可使用该 Token 来代替用户密码来通过石墨开放 API 请求用户的私有资源。</p>

<p>石墨支持 Authorization Code, Password, Provider Exchange 和 Refresh Token 四种 OAuth 授权方式，其中每种授权方式都是通过调用 <code class="prettyprint">/oauth/token</code> 接口来最终获取 Access Token，该接口需要传送 <code class="prettyprint">&quot;Authorization&quot;</code> header，内容遵循 HTTP Basic 标准，格式为 <code class="prettyprint">&quot;client_id:client_secret&quot;</code>。另外为了严格遵照 OAuth 2.0 规范，OAuth 相关的 API 均支持使用 <code class="prettyprint">application/x-www-form-urlencoded</code> 格式传送数据。</p>

<h2 id="authorization-code-方式">Authorization Code 方式</h2>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/oauth/token</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic Y2xpZW50X2lkOmNsaWVudF9zZWNyZXQ=</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">64</span>

grant_type=authorization&amp;code=yourcode
</code></pre>
<pre class="highlight plaintext"><code>// First, redirect users to the authorization page:
res.redirect(shimo.oauth.authorization({
  redirect_uri: 'https://yourapp.tld/oauth/callback'
}));

// Second, exchange token with the returned code in the callback page:
shimo.oauth.token('authorization', {
  code: req.query.code
});
</code></pre>

<p>Authorization Code 方式是最通用的授权方式，该方式尤其适用于网站使用。</p>

<p>首先第三方应用将用户重定向至授权页面 <code class="prettyprint">https://api.shimo.im/oauth/authorization</code>。</p>

<h3 id="请求-query">请求 Query</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>scope</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>需要的权限列表，以空格分隔</td>
</tr>
<tr>
<td>client_id</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>应用的 ID</td>
</tr>
<tr>
<td>redirect_uri</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>验证结果的回调网址</td>
</tr>
<tr>
<td>response_type</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>必须为 <code class="prettyprint">&quot;code&quot;</code></td>
</tr>
<tr>
<td>state</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>推荐传入一个无法猜测的随机字符串，用来防范 CSRF 攻击</td>
</tr>
</tbody></table>

<p>在该页面中用户可以选择是否向第三方应用授权，而后石墨会跳转回第三方应用。如果用户同意授权，则石墨会传回一个临时口令（<code class="prettyprint">code</code> 字段）以及在上一步传来的 <code class="prettyprint">state</code> 参数值（如果提供）。</p>

<p>最后第三方应用在后台通过 <code class="prettyprint">code</code> 的值向石墨 API 请求 Token，API endpoint 为 <code class="prettyprint">POST https://api.shimo.im/oauth/token</code>。</p>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>grant_type</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>指定为 <code class="prettyprint">&quot;authorization_code&quot;</code></td>
</tr>
<tr>
<td>code</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>上一步传回来的 <code class="prettyprint">code</code> 参数</td>
</tr>
<tr>
<td>redirect_uri</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>和第一步传的 <code class="prettyprint">redirect_uri</code> 参数一致</td>
</tr>
</tbody></table>

<p>该 API 会返回 Access Token 和 Refresh Token。</p>

<aside class="notice">
scope 的有效值分别为 `public`, `read` 和 `write`，分别对应“获取用户公开资料”、“读取用户的私有文档”和“读写用户的私有文档”。
</aside>

<h2 id="provider-exchange-方式">Provider Exchange 方式</h2>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/oauth/token</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic Y2xpZW50X2lkOmNsaWVudF9zZWNyZXQ=</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">64</span>

grant_type=provider_exchange&amp;provider_user=user_id_here
</code></pre>
<pre class="highlight plaintext"><code>shimo.oauth.token('provider_exchange', {
  provider_user: 'user_id_here'
});
</code></pre>

<p>对于限定的第三方登录提供商，石墨提供 Provider Exchange 方式来允许第三方直接获取其平台用户在石墨的 Access Token。
例如某个用户 A 是通过 OAuth 服务提供商 B 登录的石墨，此时 B 想请求 A 在石墨的 Access Token，则只需要提供 A 在 B 的用户 ID 即可。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">POST https://api.shimo.im/oauth/token</code></p>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>grant_type</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>指定为 <code class="prettyprint">provider_exchange</code></td>
</tr>
<tr>
<td>scope</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>需要的权限列表，以空格分隔</td>
</tr>
<tr>
<td>provider_user</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>目标用户在 provider 的用户 ID</td>
</tr>
</tbody></table>

<h2 id="password-方式">Password 方式</h2>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/oauth/token</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic Y2xpZW50X2lkOmNsaWVudF9zZWNyZXQ=</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">64</span>

grant_type=password&amp;username=user@shimo.im@password=strongtoken
</code></pre>
<pre class="highlight plaintext"><code>shimo.oauth.token('password', {
  username: 'user',
  password: 'strongtoken'
});
</code></pre>

<p>Password 方式允许第三方应用通过用户的邮箱和密码获取 Access Token。目前此方式只开放给指定的第三方应用。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">POST https://api.shimo.im/oauth/token</code></p>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>grant_type</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>指定为 <code class="prettyprint">password</code></td>
</tr>
<tr>
<td>scope</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>需要的权限列表，以空格分隔</td>
</tr>
<tr>
<td>username</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>用户的邮箱</td>
</tr>
<tr>
<td>password</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>用户的密码</td>
</tr>
</tbody></table>

<h2 id="refresh-token-方式">Refresh Token 方式</h2>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/oauth/token</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic Y2xpZW50X2lkOmNsaWVudF9zZWNyZXQ=</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">64</span>

grant_type=refresh_token&amp;refresh_token=tokenhere
</code></pre>
<pre class="highlight plaintext"><code>shimo.oauth.token('refresh_token', {
  refresh_token: 'tokenhere',
  password: 'strongtoken'
});
</code></pre>

<p>Access Token 的有效期为一个小时，过期后需要使用 Refresh Token 刷新。Refresh Token 除非用户主动撤销，否则永久有效。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">POST https://api.shimo.im/oauth/token</code></p>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>grant_type</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>指定为 <code class="prettyprint">refresh_token</code></td>
</tr>
<tr>
<td>scope</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>需要的权限列表，以空格分隔</td>
</tr>
<tr>
<td>refresh_token</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>Refresh Token</td>
</tr>
</tbody></table>

          <h1 id="调用-api">调用 API</h1>

<h2 id="授权">授权</h2>

<p>如果要以用户的 Access Token 授权一个 API，需要设置 HTTP 的 header <code class="prettyprint">Authorization</code> 为 <code class="prettyprint">Bearer ${token}</code>。</p>

          <h1 id="用户">用户</h1>

<h2 id="获取当前用户资料">获取当前用户资料</h2>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/users/me</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
</code></pre>
<pre class="highlight plaintext"><code>shimo.get('users/me');
</code></pre>

<blockquote>
<p>请求成功后返回样例：</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"78"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"李明"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"liming@shimo.im"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"avatar"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://static.shimo.im/avatar/2e7a00413bc9.png"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>获取当前登录用户的公开资料。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">GET https://api.shimo.im/users/me</code></p>

          <h1 id="文档">文档</h1>

<h2 id="获取文档列表">获取文档列表</h2>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/files?folder=jUiAcImUVWuhIbcW&amp;subFolders%20=true</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
</code></pre>
<pre class="highlight plaintext"><code>shimo.get('files', { qs: { folder: 'jUiAcImUVWuhIbcW' } });
</code></pre>

<blockquote>
<p>请求成功后返回样例：</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[{</span><span class="w">
  </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7WSjLS29I2Vqaa2X"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"文档一"</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"N25Dhp2vTT4uHoKt"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"文件夹一"</span><span class="w">
</span><span class="p">}]</span><span class="w">
</span></code></pre>

<p>获取指定目录下所有文档列表。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">GET https://api.shimo.im/files</code></p>

<h3 id="请求-query">请求 Query</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>folder</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>如提供，则只获取指定文件夹下的文件列表，否则返回桌面文件</td>
</tr>
</tbody></table>

<h2 id="创建文档">创建文档</h2>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/files?folder=32</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">15</span>

<span class="p">{</span><span class="nt">"folder"</span><span class="p">:</span><span class="kc">false</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight plaintext"><code>shimo.post('files', {
  qs: { folder: 32 },
  body: { folder: false }
});
</code></pre>

<blockquote>
<p>请求成功后返回样例：</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"68"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"新建文档"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div&gt;&lt;/div&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://shimo.im/docs/2da92f"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>创建一篇文档，并返回文件的信息。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">POST https://api.shimo.im/files</code></p>

<h3 id="请求-query">请求 Query</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>folder</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>如提供，则文件会创建于指定的文件夹中</td>
</tr>
</tbody></table>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>isFolder</td>
<td>否</td>
<td><code class="prettyprint">false</code></td>
<td>boolean</td>
<td>创建文件还是文件夹</td>
</tr>
<tr>
<td>name</td>
<td>否</td>
<td>新建文档</td>
<td>string</td>
<td>文件（夹）标题</td>
</tr>
</tbody></table>

<h2 id="获取文档内容">获取文档内容</h2>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/files/17</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
</code></pre>
<pre class="highlight plaintext"><code>shimo.get('files/N25Dhp2vTT4uHoKt');
</code></pre>

<blockquote>
<p>请求成功后返回样例：</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"N25Dhp2vTT4uHoKt"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"文档一"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"html"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div&gt;content goes here&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>获取指定文档的内容，包括标题、内容 HTML 等。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">GET https://api.shimo.im/files/:fileId</code></p>

<h2 id="修改文档">修改文档</h2>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/files/17</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">16</span>

<span class="p">{</span><span class="nt">"creator"</span><span class="p">:</span><span class="s2">"79"</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight plaintext"><code>shimo.patch('files/17', { body: { creator: 79 } });
</code></pre>

<p>修改文档，目前可以修改文档的管理员（默认情况下管理员即为文档的创建者）。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">PATCH https://api.shimo.im/files/:fileId</code></p>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>creator</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>文档管理员的 id</td>
</tr>
</tbody></table>

          <h1 id="错误">错误</h1>

<p>石墨 API 的错误码遵循 HTTP 规范，具体错误码和对应的描述如下。</p>

<table><thead>
<tr>
<th>错误码</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable</td>
</tr>
<tr>
<td>410</td>
<td>Gone</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="http">http</a>
                <a href="#" data-language-name="node">Node.js</a>
          </div>
      </div>
    </div>
  </body>
</html>
