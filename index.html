<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API 接口草稿</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["http","shell"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
        <div class="lang-selector">
              <a href="#" data-language-name="http">http</a>
              <a href="#" data-language-name="shell">shell</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://shimo.im'>石墨首页</a></li>
            <li><a href='https://github.com/shimohq'>石墨 GitHub</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="介绍">介绍</h1>

<p>此文档定义的 API 正在开发中，具体接口字段可能会有细节调整。</p>

          <h1 id="oauth-授权">OAuth 授权</h1>

<p>石墨鉴权接口遵循 OAuth 2.0 协议。OAuth 是一个能使得第三方应用在无需知道用户的密码的前提下读写用户私有资源的协议，第三方应用通过 OAuth 协议向用户请求授权后，可以获得一个 Access Token，此后即可使用该 Token 来代替用户密码来通过石墨开放 API 请求用户的私有资源。</p>

<p>石墨支持 Authorization Code, Password 和 Provider Exchange 三种 OAuth 授权方式。</p>

<h2 id="authorization-code-方式">Authorization Code 方式</h2>

<p>Authorization Code 方式是最通用的授权方式，该方式尤其适用于网站使用。</p>

<p>首先第三方应用将用户重定向至授权页面 <code class="prettyprint">https://api.shimo.im/oauth/authorization</code>。</p>

<h3 id="请求-query">请求 Query</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>client_id</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>应用的 ID</td>
</tr>
<tr>
<td>redirect_uri</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>验证结果的回调网址</td>
</tr>
<tr>
<td>response_type</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>必须为 <code class="prettyprint">&quot;code&quot;</code></td>
</tr>
<tr>
<td>scope</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>需要的权限列表，以空格分隔</td>
</tr>
<tr>
<td>state</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>推荐传入一个无法猜测的随机字符串，用来防范 CSRF 攻击</td>
</tr>
</tbody></table>

<p>在该页面中用户可以选择是否向第三方应用授权，而后石墨会跳转回第三方应用。如果用户同意授权，则石墨会传回一个临时口令（<code class="prettyprint">code</code> 字段）以及在上一步传来的 <code class="prettyprint">state</code> 参数值（如果提供）。</p>

<p>最后第三方应用在后台通过 <code class="prettyprint">code</code> 的值向石墨 API 请求 Token，API endpoint 为 <code class="prettyprint">POST https://api.shimo.im/oauth/token</code>。</p>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>grant_type</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>指定为 <code class="prettyprint">&quot;authorization_code&quot;</code></td>
</tr>
<tr>
<td>code</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>上一步传回来的 <code class="prettyprint">code</code> 参数</td>
</tr>
<tr>
<td>redirect_uri</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>和第一步传的 <code class="prettyprint">redirect_uri</code> 参数一致</td>
</tr>
</tbody></table>

<p>该 API 会返回 Access Token 和 Refresh Token：</p>

<h2 id="provider-exchange-方式">Provider Exchange 方式</h2>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/oauth/token</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic Y2xpZW50X2lkOmNsaWVudF9zZWNyZXQ=</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">64</span>

grant_type=provider_exchange&amp;provider_user=user_id_here
</code></pre>
<pre class="highlight shell"><code><span class="c"># Authorization 的值遵循 HTTP Basic Auth，由 client_id:client_secret 构成</span>
curl -X <span class="s2">"POST"</span> <span class="s2">"https://api.shimo.im/oauth/token"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: Basic Y2xpZW50X2lkOmNsaWVudF9zZWNyZXQ="</span> <span class="se">\</span>
    --data-urlencode <span class="s2">"grant_type=provider_exchange"</span> <span class="se">\</span>
    --data-urlencode <span class="s2">"provider_user=user_id_here"</span>
</code></pre>

<p>对于限定的第三方登录提供商，石墨提供 Provider Exchange 方式来允许第三方直接获取其平台用户在石墨的 Access Token。
例如某个用户 A 是通过 OAuth 服务提供商 B 登录的石墨，此时 B 想请求 A 在石墨的 Access Token，则只需要提供 A 在 B 的用户 ID 即可。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">POST https://api.shimo.im/oauth/token</code></p>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>grant_type</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>指定为 <code class="prettyprint">provider_exchange</code></td>
</tr>
<tr>
<td>provider_user</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>目标用户在 provider 的用户 ID</td>
</tr>
</tbody></table>

          <h1 id="调用-api">调用 API</h1>

<h2 id="授权">授权</h2>

<p>如果要以用户的 Access Token 授权一个 API，需要设置 HTTP 的 header <code class="prettyprint">Authorization</code> 为 <code class="prettyprint">Bearer ${token}</code>。</p>

          <h1 id="用户">用户</h1>

<h2 id="获取当前用户资料">获取当前用户资料</h2>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/users/me</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
</code></pre>
<pre class="highlight shell"><code>curl -X <span class="s2">"GET"</span> <span class="s2">"https://api.shimo.im/users/me"</span>
</code></pre>

<blockquote>
<p>请求成功后返回样例：</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"78"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"李明"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"liming@shimo.im"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"avatar"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://static.shimo.im/avatar/2e7a00413bc9.png"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>获取当前登录用户的公开资料。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">GET https://api.shimo.im/users/me</code></p>

          <h1 id="登录合作方">登录合作方</h1>

<p>石墨为有限的登录合作方提供专用 API 以实现文件夹权限同步绑定等功能。</p>

<h2 id="创建文档">创建文档</h2>

<p>根据合作方提供的实体 ID 来建立文档，并跳转到文档编写页面。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">POST https://api.shimo.im/provider/:provider/files</code></p>

<h3 id="请求-param">请求 Param</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>provider</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>合作方名称</td>
</tr>
</tbody></table>

<h2 id="获取文档列表">获取文档列表</h2>

<p>返回合作方提供的实体 ID 对应的文件列表</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">GET https://api.shimo.im/provider/:provider/files</code></p>

<h3 id="请求-param">请求 Param</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>provider</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>合作方名称</td>
</tr>
</tbody></table>

<h3 id="请求-query">请求 Query</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>providerEntity</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>要获取的所属实体 ID</td>
</tr>
</tbody></table>

<h2 id="获取文档内容">获取文档内容</h2>

<p>返回合作方提供的实体 ID 对应的文件列表</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">GET https://api.shimo.im/provider/:provider/files/:guid</code></p>

<h3 id="请求-param">请求 Param</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>provider</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>合作方名称</td>
</tr>
<tr>
<td>guil</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>文件的 GUID</td>
</tr>
</tbody></table>

<h3 id="请求-query">请求 Query</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>providerEntity</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>要获取的所属实体 ID</td>
</tr>
</tbody></table>

<h2 id="请求用户绑定合作方账号">请求用户绑定合作方账号</h2>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">POST https://shimo.im/sso/login/:provider</code></p>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>callback</td>
<td>是</td>
<td>无</td>
<td>string</td>
<td>登录成功后的回调地址</td>
</tr>
</tbody></table>

          <h1 id="文档">文档</h1>

<h2 id="获取文档列表">获取文档列表</h2>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/files?folderId=jUiAcImUVWuhIbcW&amp;subFolders%20=true</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
</code></pre>
<pre class="highlight shell"><code>curl -X <span class="s2">"GET"</span> <span class="s2">"https://api.shimo.im/files?folderId=jUiAcImUVWuhIbcW
</span></code></pre>

<blockquote>
<p>请求成功后返回样例：</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[{</span><span class="w">
  </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7WSjLS29I2Vqaa2X"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"文档一"</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"N25Dhp2vTT4uHoKt"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"文件夹一"</span><span class="w">
</span><span class="p">}]</span><span class="w">
</span></code></pre>

<p>获取指定目录下所有文档列表。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">GET https://api.shimo.im/files</code></p>

<h3 id="请求-query">请求 Query</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>folder</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>如提供，则只获取指定文件夹下的文件列表，否则返回桌面文件</td>
</tr>
</tbody></table>

<h2 id="创建文档">创建文档</h2>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/files?folder=32</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">15</span>

<span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"file"</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight shell"><code>curl -X <span class="s2">"POST"</span> <span class="s2">"https://api.shimo.im/files?folder=32"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">type</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">file</span><span class="se">\"</span><span class="s2">}"</span>
</code></pre>

<blockquote>
<p>请求成功后返回样例：</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"68"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"新建文档"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div&gt;&lt;/div&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://shimo.im/docs/2da92f"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>创建一篇文档，并返回文件的信息。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">POST https://api.shimo.im/files</code></p>

<h3 id="请求-query">请求 Query</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>folder</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>如提供，则文件会创建于指定的文件夹中</td>
</tr>
</tbody></table>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>isFolder</td>
<td>否</td>
<td><code class="prettyprint">false</code></td>
<td>boolean</td>
<td>创建文件还是文件夹</td>
</tr>
<tr>
<td>name</td>
<td>否</td>
<td>新建文档</td>
<td>string</td>
<td>文件（夹）标题</td>
</tr>
</tbody></table>

<h2 id="获取文档内容">获取文档内容</h2>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/files/17</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
</code></pre>
<pre class="highlight shell"><code>curl -X <span class="s2">"GET"</span> <span class="s2">"https://api.shimo.im/files/N25Dhp2vTT4uHoKt"</span>
</code></pre>

<blockquote>
<p>请求成功后返回样例：</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"N25Dhp2vTT4uHoKt"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"文档一"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"html"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div&gt;content goes here&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>获取指定文档的内容，包括标题、内容 HTML 等。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">GET https://api.shimo.im/files/:fileId</code></p>

<h2 id="修改文档">修改文档</h2>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/files/17</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">api.shimo.im</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">16</span>

<span class="p">{</span><span class="nt">"creator"</span><span class="p">:</span><span class="s2">"79"</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight shell"><code>curl -X <span class="s2">"PATCH"</span> <span class="s2">"https://api.shimo.im/files/17"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">creator</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">79</span><span class="se">\"</span><span class="s2">}"</span>
</code></pre>

<p>修改文档，目前可以修改文档的管理员（默认情况下管理员即为文档的创建者）。</p>

<h3 id="http-请求">HTTP 请求</h3>

<p><code class="prettyprint">PATCH https://api.shimo.im/files/:fileId</code></p>

<h3 id="请求-body">请求 Body</h3>

<table><thead>
<tr>
<th>参数</th>
<th>必选</th>
<th>默认值</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>creator</td>
<td>否</td>
<td>无</td>
<td>string</td>
<td>文档管理员的 id</td>
</tr>
</tbody></table>

          <h1 id="错误">错误</h1>

<p>石墨 API 的错误码遵循 HTTP 规范，具体错误码和对应的描述如下。</p>

<table><thead>
<tr>
<th>错误码</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable</td>
</tr>
<tr>
<td>410</td>
<td>Gone</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="http">http</a>
                <a href="#" data-language-name="shell">shell</a>
          </div>
      </div>
    </div>
  </body>
</html>
